# Project Forest - ローカル動作確認ガイド

## 概要

本ドキュメントは、Project Forest をローカル環境で起動し、各機能が正常に動作することを確認するための手順書です。開発者・テスター・運用担当者がシステムの動作検証を行う際に使用してください。

## 前提条件

### 必要なソフトウェア

- **Node.js**: v18.0 以上
- **npm**: v8.0 以上（または yarn v1.22 以上）
- **Git**: 最新版
- **MySQL**: v8.0 以上（またはDockerでの代替可）

### 推奨環境

- **OS**: Windows 10/11, macOS 10.15+, Ubuntu 20.04+
- **メモリ**: 8GB 以上
- **ディスク容量**: 5GB 以上の空き容量

## 環境構築手順

### 1. リポジトリのクローンと初期設定

```bash
# リポジトリのクローン
git clone <REPOSITORY_URL>
cd project-forest

# 依存関係のインストール
npm install

# または yarn を使用
yarn install
```

### 2. データベースの準備

#### 2.1 Docker を使用する場合（推奨）

```bash
# docker-compose.yml ファイルでMySQLコンテナを起動
docker-compose up -d mysql

# データベースの初期化
npm run db:init

# または直接MySQLに接続してスキーマを適用
docker exec -i project-forest-mysql mysql -u root -p < database/schema.sql
```

#### 2.2 ローカルMySQLを使用する場合

```bash
# MySQLサーバーに接続
mysql -u root -p

# データベース作成
CREATE DATABASE projectforest;
USE projectforest;

# スキーマファイルの実行
source database/schema.sql;

# 初期データの投入（オプション）
source database/seed.sql;
```

### 3. 環境変数の設定

```bash
# .env.local ファイルの作成
cp .env.example .env.local

# 環境変数の編集
nano .env.local
```

#### 3.1 .env.local の設定例

```env
# データベース接続設定
DATABASE_URL="mysql://root:password@localhost:3306/projectforest"
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=password
DB_NAME=projectforest

# Next.js設定
NEXTAUTH_SECRET=your-secret-key-here
NEXTAUTH_URL=http://localhost:3000

# 開発環境設定
NODE_ENV=development
PORT=3000

# AWS設定（オプション）
AWS_REGION=ap-northeast-1
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
S3_BUCKET_NAME=your-bucket-name

# デバッグ設定
DEBUG=true
LOG_LEVEL=debug
```

### 4. アプリケーションの起動

```bash
# 開発サーバーの起動
npm run dev

# または yarn を使用
yarn dev

# ブラウザで以下にアクセス
# http://localhost:3000
```

### 5. データベース接続確認

```bash
# データベース接続テスト
npm run db:test

# または手動でテスト
curl http://localhost:3000/api/health/db
```

## 機能別動作確認チェックリスト

### 基本動作確認

#### ✅ システム起動確認

```bash
# 1. アプリケーション起動
npm run dev

# 2. ヘルスチェック
curl http://localhost:3000/api/health

# 期待結果: {"status":"ok","timestamp":"..."}
```

#### ✅ データベース接続確認

```bash
# データベース接続テスト
curl http://localhost:3000/api/health/db

# 期待結果: {"status":"ok","database":"connected"}
```

#### ✅ 管理画面アクセス確認

1. ブラウザで `http://localhost:3000` にアクセス
2. 自動で `http://localhost:3000/admin` にリダイレクトされる
3. 管理画面のダッシュボードが表示される

### キャラクター設定機能

#### ✅ キャラクター管理画面の表示

```
手順:
1. 管理画面で「キャラクター設定」タブをクリック
2. キャラクター一覧が表示される
3. 初期データがある場合、「主人公」「エリス」が表示される

確認項目:
□ タブの切り替えが正常に動作する
□ キャラクター一覧テーブルが表示される
□ 「新規追加」ボタンが表示される
□ 検索ボックスが機能する
```

#### ✅ キャラクター新規作成

```
手順:
1. 「新規追加」ボタンをクリック
2. モーダルウィンドウが開く
3. 以下の情報を入力:
   - キャラクター名: テストキャラクター
   - 一人称: 私
   - 二人称: あなた
   - 説明: テスト用キャラクター
4. 「登録」ボタンをクリック

確認項目:
□ モーダルが正常に開く
□ 全ての入力フィールドが機能する
□ バリデーションが正常に動作する
□ 保存後にキャラクター一覧に反映される
```

#### ✅ キャラクター編集・削除

```
手順:
1. 既存キャラクターの「編集」ボタンをクリック
2. 情報を変更して「更新」ボタンをクリック
3. 「削除」ボタンをクリックして確認ダイアログで「OK」

確認項目:
□ 編集モーダルが正常に開く
□ 既存データがフォームに表示される
□ 更新処理が正常に完了する
□ 削除確認ダイアログが表示される
□ 削除後に一覧から除外される
```

#### ✅ キャラクター検索機能

```
手順:
1. 検索ボックスに「主人公」と入力
2. 検索結果が動的に更新される
3. 検索ボックスをクリアして全件表示に戻る

確認項目:
□ リアルタイム検索が動作する
□ 部分一致検索が機能する
□ 検索結果の絞り込みが正確
□ 検索条件クリア後に全件表示される
```

### タグ管理機能

#### ✅ タグ管理画面の表示

```
手順:
1. 「タグ管理」タブをクリック
2. タグ一覧が表示される
3. 初期データの確認（character_name, player_name等）

確認項目:
□ タグ一覧テーブルが表示される
□ アイコンが正常に表示される
□ 表示テキストがバッジ形式で表示される
□ 情報メッセージが表示される
```

#### ✅ タグ新規作成

```
手順:
1. 「新規タグ追加」ボタンをクリック
2. 以下の情報を入力:
   - タグ名: test_tag
   - 表示テキスト: {TEST_TAG}
   - アイコン: 🧪
   - 説明: テスト用タグ
3. 「登録」ボタンをクリック

確認項目:
□ タグ名のフォーマット検証が動作する
□ 表示テキストのプレビューが正確
□ アイコンの表示が正常
□ 保存後にタグ一覧に反映される
```

#### ✅ タグ検索機能

```
手順:
1. 既存タグの「検索」ボタンをクリック
2. 使用箇所検索のアラートが表示される

確認項目:
□ 検索ボタンが機能する
□ 適切なメッセージが表示される
□ （実装時）使用箇所が正確に表示される
```

### 固有名詞管理機能

#### ✅ 固有名詞管理画面の表示

```
手順:
1. 「固有名詞管理」タブをクリック
2. 固有名詞一覧が表示される
3. 統計情報が正しく表示される

確認項目:
□ 固有名詞一覧テーブルが表示される
□ カテゴリフィルターが機能する
□ 統計情報（登録済み数等）が表示される
□ 未登録語句の警告が表示される（ある場合）
```

#### ✅ 固有名詞新規作成

```
手順:
1. 「新規追加」ボタンをクリック
2. 以下の情報を入力:
   - 固有名詞: テスト王国
   - 読み方: てすとおうこく
   - 英語表記: Test Kingdom
   - カテゴリ: 地名
   - 説明: テスト用の王国
3. 「登録」ボタンをクリック

確認項目:
□ 全ての入力フィールドが機能する
□ カテゴリ選択が正常に動作する
□ 保存後に一覧に反映される
□ カテゴリ別の統計が更新される
```

#### ✅ 検索・フィルタ機能

```
手順:
1. 検索ボックスに「エルデン」と入力
2. カテゴリフィルターで「アイテム・道具」を選択
3. フィルターをクリアして全件表示に戻る

確認項目:
□ テキスト検索が正常に動作する
□ カテゴリフィルターが機能する
□ 複合条件での絞り込みが正確
□ フィルタークリア機能が動作する
```

### 禁止用語管理機能

#### ✅ 禁止用語管理画面の表示

```
手順:
1. 「禁止用語管理」タブをクリック
2. 禁止用語一覧が表示される
3. 検出アラートが表示される（ある場合）

確認項目:
□ 禁止用語一覧テーブルが表示される
□ カテゴリ別の色分けが正常
□ 統計情報が正確に表示される
□ 検出アラートが適切に表示される
```

#### ✅ 禁止用語新規作成

```
手順:
1. 「新規追加」ボタンをクリック
2. 以下の情報を入力:
   - 禁止用語: テスト語
   - 置換語: 代替語
   - カテゴリ: その他
   - 理由: テスト用
3. 「登録」ボタンをクリック

確認項目:
□ 入力フィールドが正常に動作する
□ カテゴリ選択が機能する
□ 理由の入力が必須チェックされる
□ 保存後に一覧に反映される
```

#### ✅ 自動検出機能

```
手順:
1. 「全テキストスキャン」ボタンをクリック
2. 検出処理のアラートが表示される

確認項目:
□ スキャンボタンが機能する
□ 適切なメッセージが表示される
□ （実装時）検出結果が正確に表示される
```

### スタイル設定機能

#### ✅ スタイル設定画面の表示

```
手順:
1. 「スタイル設定」タブをクリック
2. スタイル一覧がカード形式で表示される
3. プレビュー機能が動作する

確認項目:
□ スタイルカードが正常に表示される
□ プレビューが各スタイルで正確
□ 操作ボタンが機能する
□ 情報メッセージが表示される
```

#### ✅ スタイル新規作成

```
手順:
1. 「新規スタイル追加」ボタンをクリック
2. 以下の設定を入力:
   - スタイル名: テストスタイル
   - フォント: Noto Sans JP
   - 最大文字数: 20
   - 最大行数: 3
   - フォントサイズ: 16
3. プレビューで確認
4. 「作成」ボタンをクリック

確認項目:
□ モーダルが正常に開く
□ 全ての設定項目が機能する
□ リアルタイムプレビューが動作する
□ 文字数・行数カウントが正確
□ 保存後にスタイル一覧に追加される
```

#### ✅ スタイル編集・複製・削除

```
手順:
1. 既存スタイルの「編集」ボタンをクリック
2. 設定を変更して「更新」
3. 「複製」ボタンでスタイルをコピー
4. 「削除」ボタンで削除実行

確認項目:
□ 編集モーダルが正常に開く
□ 既存設定が正確に表示される
□ 複製機能が正常に動作する
□ 削除確認ダイアログが表示される
□ 操作後に一覧が正しく更新される
```

## エラーケース・例外処理の確認

### バリデーションエラー

#### ✅ 必須項目チェック

```
手順:
1. 各機能で必須項目を空にして保存実行
2. エラーメッセージが表示される

確認項目:
□ 適切なエラーメッセージが表示される
□ 必須項目がハイライトされる
□ 保存処理が中断される
```

#### ✅ 文字数制限チェック

```
手順:
1. 各入力フィールドで制限を超える文字数を入力
2. バリデーションエラーが表示される

確認項目:
□ 文字数制限が正しく動作する
□ リアルタイムでエラー表示される
□ 制限値が明確に示される
```

### ネットワークエラー

#### ✅ データベース接続エラー

```
手順:
1. データベースサーバーを停止
2. 各機能でデータ操作を実行
3. 適切なエラーハンドリングが動作する

確認項目:
□ 接続エラーが適切に検出される
□ ユーザーフレンドリーなエラーメッセージ
□ アプリケーションがクラッシュしない
```

#### ✅ タイムアウトエラー

```
手順:
1. ネットワークを意図的に遅延させる
2. 長時間かかる操作を実行
3. タイムアウト処理が動作する

確認項目:
□ 適切なタイムアウト時間が設定されている
□ ローディング表示が機能する
□ タイムアウト時のエラーハンドリング
```

## パフォーマンス確認

### レスポンス時間測定

#### ✅ ページ読み込み時間

```bash
# Chrome DevTools でのパフォーマンス測定
# または curl での測定
curl -w "@curl-format.txt" -o /dev/null -s http://localhost:3000/admin

# curl-format.txt の内容:
#      time_namelookup:  %{time_namelookup}\n
#         time_connect:  %{time_connect}\n
#      time_appconnect:  %{time_appconnect}\n
#     time_pretransfer:  %{time_pretransfer}\n
#        time_redirect:  %{time_redirect}\n
#   time_starttransfer:  %{time_starttransfer}\n
#                      ----------\n
#           time_total:  %{time_total}\n

期待値: 
□ 初回読み込み: 3秒以内
□ 2回目以降: 1秒以内
□ API レスポンス: 500ms以内
```

#### ✅ 大量データ処理

```
手順:
1. データベースに大量のテストデータを投入
2. 一覧表示やフィルタリング機能をテスト
3. パフォーマンスを測定

確認項目:
□ 1000件以上のデータでも正常動作
□ ページネーション機能が正常
□ 検索・フィルタが高速
```

### メモリ使用量確認

#### ✅ メモリリーク検出

```
手順:
1. Chrome DevTools のメモリタブを開く
2. 各機能を繰り返し実行
3. メモリ使用量の増加を監視

確認項目:
□ メモリ使用量が適切に解放される
□ 長時間使用でもメモリリークしない
□ 大量データ処理後にメモリが解放される
```

## ブラウザ互換性確認

### 対応ブラウザでのテスト

#### ✅ Chrome

```
確認項目:
□ 全機能が正常に動作する
□ レスポンシブデザインが適切
□ パフォーマンスが良好
```

#### ✅ Firefox

```
確認項目:
□ 全機能が正常に動作する
□ CSS表示が正確
□ JavaScript機能が正常
```

#### ✅ Edge

```
確認項目:
□ 全機能が正常に動作する
□ 古いEdgeでの互換性
□ モーダル等のUI要素が正常
```

#### ✅ Safari

```
確認項目:
□ 基本機能が動作する
□ ファイルアップロード機能の制限確認
□ CSS のベンダープレフィックス対応
```

## モバイル端末での確認

### レスポンシブデザイン

#### ✅ スマートフォン表示

```
手順:
1. Chrome DevTools でモバイル表示に切り替え
2. 各画面で表示を確認
3. タッチ操作をシミュレート

確認項目:
□ レイアウトが適切に調整される
□ ボタンがタッチしやすいサイズ
□ スクロールが正常に動作する
□ モーダルが画面に収まる
```

#### ✅ タブレット表示

```
確認項目:
□ 中間サイズでのレイアウト
□ タッチ操作の精度
□ 横向き・縦向きでの表示
```

## セキュリティ確認

### 基本的なセキュリティチェック

#### ✅ XSS対策

```
手順:
1. 入力フィールドに以下を入力:
   <script>alert('XSS')</script>
2. 保存・表示して動作確認

確認項目:
□ スクリプトが実行されない
□ HTMLエスケープが正常に動作
□ サニタイゼーション機能が有効
```

#### ✅ SQLインジェクション対策

```
手順:
1. 検索フィールドに以下を入力:
   ' OR '1'='1
2. データベースクエリの動作確認

確認項目:
□ 不正なクエリが実行されない
□ パラメータ化クエリが使用されている
□ エラーが適切にハンドリングされる
```

## ログ・デバッグ情報の確認

### ログ出力確認

#### ✅ アプリケーションログ

```bash
# コンソールログの確認
npm run dev

# ログファイルの確認（本番環境）
tail -f logs/application.log

確認項目:
□ 適切なログレベルで出力される
□ エラー情報が詳細に記録される
□ パフォーマンス情報が記録される
□ 個人情報が記録されていない
```

#### ✅ データベースログ

```sql
-- スロークエリログの確認
SHOW VARIABLES LIKE 'slow_query_log';
SHOW VARIABLES LIKE 'long_query_time';

確認項目:
□ スロークエリが適切に検出される
□ インデックスが効率的に使用される
□ N+1クエリ問題が発生していない
```

## 負荷テスト

### 簡易負荷テスト

#### ✅ 同時接続テスト

```bash
# Apache Bench での負荷テスト
ab -n 1000 -c 10 http://localhost:3000/admin

# または curl での並列テスト
for i in {1..10}; do
  curl http://localhost:3000/api/health &
done
wait

確認項目:
□ 同時接続が適切に処理される
□ レスポンス時間が許容範囲内
□ エラー率が低い
□ サーバーがクラッシュしない
```

## 終了処理・クリーンアップ

### テスト環境のクリーンアップ

```bash
# テストデータの削除
npm run db:clean

# または手動でのデータ削除
mysql -u root -p -e "DELETE FROM projectforest.characters WHERE name LIKE 'テスト%';"

# 開発サーバーの停止
Ctrl+C

# Dockerコンテナの停止（使用している場合）
docker-compose down
```

## トラブルシューティング

### よくある問題と解決方法

#### データベース接続エラー

```
エラー: "ECONNREFUSED"
解決方法:
1. MySQLサーバーが起動しているか確認
2. 接続情報（ホスト、ポート、認証情報）の確認
3. ファイアウォール設定の確認
```

#### ポート競合エラー

```
エラー: "EADDRINUSE"
解決方法:
1. 既存プロセスの確認: lsof -i :3000
2. プロセスの終了: kill -9 <PID>
3. 別ポートでの起動: PORT=3001 npm run dev
```

#### メモリ不足エラー

```
エラー: "JavaScript heap out of memory"
解決方法:
1. Node.jsメモリ制限の増加: 
   NODE_OPTIONS="--max-old-space-size=4096" npm run dev
2. 不要なプロセス・アプリケーションの終了
3. システムメモリの確認
```

#### ビルドエラー

```
エラー: TypeScript/Next.js関連
解決方法:
1. 型定義の確認とインストール
2. キャッシュのクリア: npm run clean
3. 依存関係の再インストール: rm -rf node_modules && npm install
```

## 検証結果レポート

### チェックリスト

本ガイドを完了したら、以下のチェックリストで結果を記録してください：

```
□ 環境構築が正常に完了した
□ 全ての基本機能が動作している
□ キャラクター管理機能が正常
□ タグ管理機能が正常
□ 固有名詞管理機能が正常
□ 禁止用語管理機能が正常
□ スタイル設定機能が正常
□ エラーハンドリングが適切
□ パフォーマンスが許容範囲内
□ セキュリティチェックが完了
□ ブラウザ互換性が確認済み
□ レスポンシブデザインが適切
□ ログ出力が正常
□ 負荷テストが完了

問題が発見された場合:
- 問題の詳細
- 再現手順
- 期待する動作
- 実際の動作
- スクリーンショット（可能であれば）
```

---

**最終更新**: 2024年1月  
**バージョン**: 1.0.0  
**作成者**: Project Forest 開発チーム